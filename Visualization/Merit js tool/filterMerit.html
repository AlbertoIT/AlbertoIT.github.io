<!DOCTYPE html>
<html>
<head>
<script src="jquery-2.1.0.min.js"></script>
  <meta charset="utf-8">
  <title>Full Merit History</title>
  <div id="tableSent"></div>
  <div id="tableReceived"></div>
  <script>
function loadJSON(callback) {   
  var xobj = new XMLHttpRequest();
  xobj.overrideMimeType("application/json");
  xobj.open('GET', 'content.json', true);
  xobj.onreadystatechange = function () {
    if (xobj.readyState == 4 && xobj.status == "200") {
      callback(JSON.parse(xobj.responseText));
    }
  };
  xobj.send(null);  
}

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}

var result;
var userid=getParameterByName("id");
loadJSON(function(json) {
  var receivedMerit=$(json).filter(function (i,n){return n.to==userid});

var txt="";
var totalReceived=0;
var totalSent=0;
txt += "<table border='1'>"
        txt +="<tr><td colspan='5'>Received</td></tr>"
        txt +="<tr><td>From</td><td>To</td><td>Merits</td><td>Date</td><td>Msg</td></tr>"
        for (x in receivedMerit.toArray()) {
            totalReceived+=receivedMerit[x].merit;
            txt += "<tr><td><a href='https://albertoit.github.io/Visualization/Merit%20js%20tool/filterMerit.html?id=" + receivedMerit[x].from + "'>" + receivedMerit[x].from + "</a></td><td><a href='https://albertoit.github.io/Visualization/Merit%20js%20tool/filterMerit.html?id=" + receivedMerit[x].to + "'>" + receivedMerit[x].to + "</a></td><td>" + receivedMerit[x].merit + "</td><td>" + receivedMerit[x].date + "</td><td><a href='" + receivedMerit[x].Msg + "'>Msg</a></td></tr>";
        }
        txt +="<tr><td colspan='5'>Total received: " + totalReceived + "</td></tr>"
        txt += "</table>"        


        document.getElementById("tableReceived").innerHTML = txt;

var sentMerit=$(json).filter(function (i,n){return n.from==userid});

txt = "<table border='1'>"
        txt +="<tr><td colspan='5'>Sent</td></tr>"
        txt +="<tr><td>From</td><td>To</td><td>Merits</td><td>Date</td><td>Msg</td></tr>"
        for (x in sentMerit.toArray()) {
            totalSent+=sentMerit[x].merit;
            txt += "<tr><td><a href='https://albertoit.github.io/Visualization/Merit%20js%20tool/filterMerit.html?id=" + sentMerit[x].from + "'>" + sentMerit[x].from + "</a></td><td><a href='https://albertoit.github.io/Visualization/Merit%20js%20tool/filterMerit.html?id=" + sentMerit[x].to + "'>" + sentMerit[x].to + "</a></td><td>" + sentMerit[x].merit + "</td><td>" + sentMerit[x].date + "</td><td><a href='" + sentMerit[x].Msg + "'>Msg</a></td></tr>";
        }
        txt +="<tr><td colspan='5'>Total sent: " + totalSent + "</td></tr>"
        txt += "</table>"        


       document.getElementById("tableSent").innerHTML = txt;
});
 
</script>
</head>
<body>

</body>
</html>

